<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Site em Teste</title>

<link rel="manifest" href="manifest.json">
<link rel="icon" href="https://i.imgur.com/jFQiZvL.jpeg">
<link rel="apple-touch-icon" href="https://i.imgur.com/jFQiZvL.jpeg">
<meta name="theme-color" content="#1e90ff">

<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js")
    .then(() => console.log("SW registrado"))
    .catch(err => console.error("Erro SW:", err));
}
</script>

<style>
body { margin:0; padding-top:60px; background:#101010; font-family:Arial,sans-serif; color:#fff; overflow:hidden; }
#topBar { position:fixed; top:0; left:0; height:60px; width:100%; background:#000000aa; display:flex; align-items:center; padding:0 15px; justify-content:space-between; z-index:10000; backdrop-filter: blur(4px); font-size:15px; }
#senhaSection { height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center; background:#000; text-align:center; padding:20px; gap:15px; overflow-y:auto; }
#senhaInput { padding:12px; width:260px; text-align:center; border-radius:6px; border:none; background:#222; color:#fff; }
#senhaBtn, .btn-neon { margin-top:10px; padding:10px 20px; background:#1e90ff; border:none; color:#fff; border-radius:6px; cursor:pointer; font-size:15px; }
.btn-neon { padding:14px 28px; font-size:17px; font-weight:bold; color:#00e5ff; background:linear-gradient(145deg,#0d0d0d,#1a1a1a); border:2px solid #00e5ff; border-radius:14px; cursor:pointer; transition:all 0.3s ease; box-shadow:0 0 12px rgba(0,229,255,0.3); text-transform:uppercase; letter-spacing:1px; margin-top:15px; }
.btn-neon:hover { background:#00e5ff; color:#121212; box-shadow:0 0 15px #00e5ff,0 0 35px #00b0ff,0 0 55px #0091ea; transform:scale(1.08); }
.container { display:none; height:100vh; flex-direction:row; }
.sidebar { width:290px; background:#0d0d0d; border-right:1px solid #222; overflow-y:auto; padding:15px; }
.top-buttons button { width:100%; padding:10px; margin-bottom:8px; background:#181818; border:1px solid #333; border-radius:8px; cursor:pointer; color:#fff; font-weight:bold; transition:0.2s; }
.top-buttons button:hover { background:#1e90ff33; border-color:#1e90ff; }
.category-label { background:linear-gradient(to right,#1e90ff55,#0000); padding:8px 10px; margin-top:10px; border-left:3px solid #1e90ff; border-radius:4px; font-size:15px; cursor:pointer; }
.channel { display:flex; align-items:center; padding:10px; margin-top:5px; border-radius:8px; cursor:pointer; transition:0.15s; background:#181818; }
.channel:hover { background:#1e1e1e; transform:translateX(4px); }
.channel img { width:50px; height:50px; margin-right:12px; border-radius:6px; border:1px solid #444; }
.favorite-btn { font-size:20px; background:none; border:none; cursor:pointer; color:gold; }
.favorite-btn.not-fav { color:#555; }
.main { flex:1; display:flex; flex-direction:column; }
#channelListRight { padding:15px; overflow-y:auto; height:100vh; background:#111; border-left:1px solid #222; }
#videoContainer { width:100%; height:100vh; background:#000; display:none; border-top:2px solid #1e90ff; position:relative; }
#player { width:100%; height:100%; }
.player-controls { position:absolute; top:10px; left:50%; transform:translateX(-50%); z-index:5; display:flex; gap:10px; }
.player-controls button { padding:6px 12px; border-radius:6px; background:rgba(0,0,0,0.55); backdrop-filter:blur(4px); color:#fff; border:1px solid #333; cursor:pointer; }
.focused { outline: 3px solid #1e90ff !important; background-color: #1e90ff33 !important; transform: scale(1.03);}
</style>
</head>
<body>

<!-- TELA DE LOGIN -->
<div id="senhaSection">
  <div style="max-width:480px; background:#111; padding:15px; border-radius:12px; box-shadow:0 0 12px rgba(0,0,0,0.7); color:#fff; line-height:1.4; font-size:13px;">
    <h2 style="color:#1e90ff; text-align:center; margin-bottom:10px; font-size:18px;">Bem-vindo!</h2>
    <button id="testarGratisBtnLogin" class="btn-neon">Testar Gr√°tis</button>
    <a href="https://sites.google.com/view/teste-helyssom/in%C3%ADcio" target="_blank">
      <button class="btn-neon" style="font-size:13px; padding:10px 20px; margin-top:10px;">Seja S√≥cio</button>
    </a>
  </div>
  <div style="display:flex; flex-direction:column; align-items:center; gap:8px; margin-top:15px;">
    <input id="senhaInput" type="password" placeholder="Digite sua senha">
    <button id="senhaBtn">Entrar</button>
  </div>
</div>

<!-- CONTAINER PRINCIPAL IPTV -->
<div class="container">
  <div class="sidebar">
    <div class="top-buttons">
      <button id="btnListaSalva">Lista Salva</button>
      <button id="btnFavoritos">Favoritos</button>
    </div>
    <h2>Categorias</h2>
    <div id="channelList"></div>
  </div>
  <div class="main">
    <div id="channelListRight"></div>
    <div id="videoContainer">
      <div id="player"></div>
      <div class="player-controls">
        <button id="exitBtn">üì∫ Menu</button>
        <button id="prevBtn">‚èÆÔ∏è</button>
        <button id="nextBtn">‚è≠Ô∏è</button>
      </div>
    </div>
  </div>
</div>

<script>
const listaSalvaUrl = "https://raw.githubusercontent.com/Isac-Arqueiro/vip01/refs/heads/main/canais";
const categoriasValidas = ['Classic','Series','Kids','Religioso','Variedade','TESTE','Canal aberto','Esporte','Anima√ß√£o','RunTime','Filmes','News','URBAN'];
const senhasValidas = ["2025","A0C02550","A0X02551","A0Z02552"];
let allChannels = [];
let favorites = JSON.parse(localStorage.getItem("favorites") || "[]");
let currentIndex = 0;
let canaisAtuais = [];
let lastCategory = null;
let lastIndex = 0;

const senhaSection = document.getElementById("senhaSection");
const container = document.querySelector(".container");
const channelList = document.getElementById("channelList");
const rightList = document.getElementById("channelListRight");
const videoContainer = document.getElementById("videoContainer");

// ==================== LOGIN ====================
document.getElementById("senhaBtn").onclick = () => {
  const senha = document.getElementById("senhaInput").value;
  if (senhasValidas.includes(senha)) {
    localStorage.setItem("iptv_password", senha);
    senhaSection.style.display = "none";
    container.style.display = "flex";
    carregarLista(listaSalvaUrl);
  } else { alert("Senha incorreta!"); }
};
window.onload = () => {
  const savedSenha = localStorage.getItem("iptv_password");
  if (senhasValidas.includes(savedSenha)) {
    senhaSection.style.display = "none";
    container.style.display = "flex";
    carregarLista(listaSalvaUrl);
  }
};
document.getElementById("testarGratisBtnLogin").onclick = () => {
  document.getElementById("senhaInput").value = "2025";
  document.getElementById("senhaBtn").click();
};

// ==================== IPTV Fun√ß√µes ====================
async function carregarLista(url) {
  try {
    const res = await fetch(url);
    const data = await res.text();
    allChannels = parseM3U(data);
    renderCategorias();
    // Restaurar √∫ltima categoria e canal
    if(lastCategory) {
      const catDivs = document.querySelectorAll(".category-label");
      const catIndex = Array.from(catDivs).findIndex(d => d.textContent === lastCategory);
      if(catIndex>=0) catDivs[catIndex].click();
      currentIndex = lastIndex || 0;
    }
  } catch { alert("Erro ao carregar lista."); }
}
function parseM3U(txt) {
  const linhas = txt.split("\n");
  let canais = [];
  let canal = null;
  for (let l of linhas) {
    l = l.trim();
    if (l.startsWith("#EXTINF")) {
      canal = { tvg_name: (l.match(/tvg-name="([^"]+)"/) || ["", "Sem Nome"])[1],
                tvg_logo: (l.match(/tvg-logo="([^"]+)"/) || ["", ""])[1],
                group_title: (l.match(/group-title="([^"]+)"/) || ["", "Outros"])[1],
                url: "" };
    } else if (l && canal) { canal.url = l; canais.push(canal); canal=null; }
  }
  return canais;
}
function renderCategorias() {
  channelList.innerHTML = "";
  categoriasValidas.forEach(cat => {
    const div = document.createElement("div");
    div.className = "category-label";
    div.textContent = cat;
    div.onclick = () => {
      lastCategory = cat;
      const canais = allChannels.filter(c => c.group_title === cat);
      canaisAtuais = canais;
      renderChannelList(canais);
      // Restaurar √∫ltima posi√ß√£o
      if(lastCategory === cat && lastIndex!==undefined && lastIndex<canais.length) {
        currentIndex = lastIndex;
      } else {
        currentIndex = 0;
      }
    };
    channelList.appendChild(div);
  });
}
function renderChannelList(canais) {
  rightList.innerHTML = "";
  canais.forEach((canal, index) => {
    const div = document.createElement("div");
    div.className = "channel";
    div.dataset.index = index;
    div.innerHTML = `<img src="${canal.tvg_logo||'https://via.placeholder.com/50'}"><span>${canal.tvg_name}</span>
                     <button class="favorite-btn ${favorites.includes(canal.tvg_name) ? "" : "not-fav"}">
                     ${favorites.includes(canal.tvg_name) ? "‚òÖ" : "‚òÜ"}</button>`;
    div.querySelector("button").onclick = (e) => { e.stopPropagation(); toggleFavorite(canal.tvg_name,e.target); };
    div.onclick = () => { currentIndex=index; lastIndex=index; playChannel(canal); };
    rightList.appendChild(div);
  });
}

// ==================== FAVORITOS ====================
function toggleFavorite(name, btn) {
  if(favorites.includes(name)) favorites=favorites.filter(n=>n!==name);
  else favorites.push(name);
  localStorage.setItem("favorites", JSON.stringify(favorites));
  btn.textContent = favorites.includes(name)?"‚òÖ":"‚òÜ";
  btn.classList.toggle("not-fav");
}

// ==================== FUN√á√ÉO MX PLAYER ====================
function playChannel(canal) {
  if(!canal.url) return;
  const isAndroid = /Android/i.test(navigator.userAgent);
  if(!isAndroid){
    alert("O MX Player funciona apenas em Android.");
    return;
  }

  const intentURL = `intent:${canal.url}#Intent;package=com.mxtech.videoplayer.ad;S.title=${canal.tvg_name};end`;

  const iframe = document.createElement('iframe');
  iframe.style.display = 'none';
  iframe.src = intentURL;
  document.body.appendChild(iframe);
  
  setTimeout(() => {
    document.body.removeChild(iframe);
    alert("Se o MX Player n√£o abriu, verifique se est√° instalado.");
  },2000);
}

// ==================== CONTROLES ====================
document.getElementById("exitBtn").onclick = () => { videoContainer.classList.remove("active"); };
document.getElementById("prevBtn").onclick = () => { 
  currentIndex=(currentIndex-1+canaisAtuais.length)%canaisAtuais.length; 
  lastIndex=currentIndex;
  playChannel(canaisAtuais[currentIndex]); 
};
document.getElementById("nextBtn").onclick = () => { 
  currentIndex=(currentIndex+1)%canaisAtuais.length; 
  lastIndex=currentIndex;
  playChannel(canaisAtuais[currentIndex]); 
};

// ==================== MENU ====================
document.getElementById("btnListaSalva").onclick = () => carregarLista(listaSalvaUrl);
document.getElementById("btnFavoritos").onclick = () => {
  const favChannels = allChannels.filter(c => favorites.includes(c.tvg_name));
  canaisAtuais = favChannels;
  renderChannelList(favChannels);
};

// ==================== NAVEGA√á√ÉO REMOTA ====================
let focusIndex = 0;
let focusType = "category";

function applyFocus() {
  document.querySelectorAll(".focused").forEach(el => el.classList.remove("focused"));
  if(focusType==="category") { const cats=document.querySelectorAll(".category-label"); if(cats[focusIndex]) cats[focusIndex].classList.add("focused"); }
  else if(focusType==="channel") { const ch=document.querySelectorAll(".channel"); if(ch[focusIndex]) ch[focusIndex].classList.add("focused"); }
}

document.addEventListener("keydown", (e) => {
  const key=e.key;
  if(key==="ArrowDown") moveFocus(1);
  if(key==="ArrowUp") moveFocus(-1);
  if(key==="ArrowRight"){ if(focusType==="category"){ focusType="channel"; focusIndex=0; applyFocus(); } }
  if(key==="ArrowLeft"){ if(focusType==="channel"){ focusType="category"; focusIndex=0; applyFocus(); } }
  if(key==="Enter") selectFocused();
  if(key==="Backspace"||key==="Escape"){ if(videoContainer.classList.contains("active")) exitBtn.click(); focusType="channel"; applyFocus(); }
});

function moveFocus(dir) {
  if(focusType==="category"){ const cats=document.querySelectorAll(".category-label"); focusIndex=Math.max(0, Math.min(cats.length-1, focusIndex+dir)); applyFocus(); }
  else if(focusType==="channel"){ const ch=document.querySelectorAll(".channel"); focusIndex=Math.max(0, Math.min(ch.length-1, focusIndex+dir)); applyFocus(); }
}

function selectFocused() {
  if(focusType==="category"){ const cats=document.querySelectorAll(".category-label"); if(cats[focusIndex]) cats[focusIndex].click(); }
  else if(focusType==="channel"){ const ch=document.querySelectorAll(".channel"); if(ch[focusIndex]) ch[focusIndex].click(); }
}
</script>

</body>
</html>
